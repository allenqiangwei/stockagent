# AI 策略实验室 — 实验结果分析

> 更新时间: 2026-02-15 | 总实验: 158 | 总策略: 1215 | 有效(done): 825 | 无效(invalid): 390 | 盈利: 108 (13.1%) | Standard A: 18个 | 组合策略: 已实现 | 规则引擎P4: 已完成

---

## 核心洞察

> **十一轮实验、141个主题、1086个策略的核心发现**:

1. **KDJ 是 A 股最有效的技术指标** — 四轮实验持续验证。第四轮 67 个 KDJ 主题产出 26 个盈利策略, 最高收益 +60.7%, 且 5 个策略在牛/熊/震荡全阶段盈利
2. **KDJ+MACD 是最佳指标组合** — 双金叉(+34.1%), 趋势跟踪(+29.3%), 底背离(+26.9%) 三个方向均有不错收益
3. **短周期 KDJ(6,3,3) 比默认(9,3,3)更优** — 40% 盈利率, 最佳回撤仅 6.6%, 适合 A 股快进快出
4. **全阶段盈利策略的共同特征: 短持仓+快换手** — 5 个全阶段盈利策略全部是短线/超短线类
5. **震荡市是最大利润杀手** — 仅 4% 的策略在震荡市盈利, 而 A 股大部分时间处于震荡
6. **3+ 指标组合适得其反** — 2 个互补指标是组合上限, 3+ 指标几乎全军覆没
7. **3-4 个买入条件最优** — 2 条件过于宽松, 5+ 条件导致零交易
8. **纯均线/EMA策略在 A 股无效** — 均线金叉/EMA趋势追踪连续四轮 0 盈利, EMA+ATR动态止损全军覆没(-50%~-98%)
9. **CMF在A股几乎永远为负** — CMF_20对绝大多数A股股票持续为负值(测试茅台: -0.51~-0.003), CMF>0几乎不可能。先前21%盈利率来自多指标组合中CMF不起主导作用, 独立使用全军覆没
10. **BOLL_lower 最佳收益 +59.0%** — 布林下轨买入有强反弹动能
11. **规则引擎P4升级已完成, DeepSeek仍是瓶颈** — 新增6种compare_type(lookback_min/max/value, consecutive, pct_diff, pct_change), 支持N日回溯/连续涨跌/百分比偏差条件。条件可达性预检可在回测前检测矛盾条件。但DeepSeek即使收到详细格式说明仍不使用新类型, 需要更强的few-shot示例或硬编码模板
12. **非KDJ指标组合表现不佳** — KDJ+RSI(0%), KDJ+EMA(0%), MACD+RSI(6.7%), EMA+ATR(0%)四组P2实验合计仅1/23盈利; KDJ+MACD仍是唯一有效双指标组合
13. **RSI极端超卖(<25)盈利率高但信号极少** — 简化版4/6盈利(66.7%), 但保守版仅4-17笔交易, 最高+6.1%; 阈值放宽到RSI<30则亏损; 统计意义不足, 不适合独立使用
14. **KDJ+MACD短周期参数(6,3,3)+(8,17,9)不优于默认** — 短周期精调1/8盈利(+17.5%, score 0.57), 远不如默认参数(+34.1%, score 0.68); 默认参数已是最优
15. **放量条件对KDJ无增益** — KDJ金叉+放量确认0/8盈利, volume突破在A股超卖区不是有效信号, 可能因超卖区放量多为出货而非进场
16. **MACD柱线翻正作为主信号灾难性** — 0/8盈利, 亏损-37%~-99.8%, MACD_hist>0过于频繁触发, 震荡市单策略亏超3000元
17. **DeepSeek无法精确复现已有策略** — 即使描述相同买入条件, DeepSeek生成的实际规则与原始策略存在微妙差异, 导致"止盈止损优化"实验0/8盈利(原策略+37.1%)
18. **ADX/MA20等趋势过滤无法对抗震荡市** — ADX>25在震荡市中也会被短暂波动触发, MA20方向过滤有微弱效果但不足以盈利。没有任何单一技术指标能可靠识别并过滤震荡市
19. **field-to-field比较功能正常** — 规则引擎支持close<BOLL_lower等field比较, P7不是bug。但BOLL下轨条件极度严苛(close跌破布林下轨+超卖), 几乎无法触发
20. **新扩展指标大规模探索: 绝大多数无效** — 第十轮新增33个TA-lib指标, 20+实验160+策略全部完成。done=89中仅14个盈利(15.7%), 3个达Standard A。仅PSAR/ULCER/Keltner/UltimateOsc/Stochastic/BOLL%B+StochRSI有效, 其余全部无效
21. **PSAR是KDJ之外最有效的新指标** — PSAR+ADX+CCI+BOLL组合score=0.66/ret+14.3%/dd仅6.1%达到Standard A, PSAR+RSI+BOLL震荡市盈利+95元(罕见)。PSAR作为止损反转指标与多指标组合表现优秀
22. **Keltner+ULCER低波动策略有独特价值** — ULCER<5+KDJ_K<25组合盈利率38%(3/8), 最佳+19.5%。ULCER是唯一有效衡量下行风险的指标, 低ULCER+超卖=高概率反弹
23. **BOLL%B+StochRSI是最佳新发现** — 收益+37.9%/score 0.66/233trades, 达到Standard A。StochRSI比普通RSI更灵敏, BOLL%B比原始BOLL提供更标准化信号
24. **UltimateOscillator是最大惊喜** — 批量重试后ID129以50%盈利率(3/6)突出, 中性版C score=0.72/ret+28.0%/dd11.2%达Standard A。ULTOSC综合三周期(7/14/28)动量, 是KDJ/MACD之外第三个有效的独立震荡指标
25. **Stochastic(STOCH)也有价值** — ID128以50%盈利率(2/4)超预期, 保守版C +28.4%/dd23.4%。但STOCH_K和STOCH_D与KDJ类似, 非独立发现
26. **三层防护系统有效防止回测挂死** — L1增强信号爆炸检测(周期性重检每50天), L2单策略5分钟超时(threading.Timer+cancel_event), L3实验60分钟看门狗。323策略重试零挂死
27. **组合策略(P3)信号投票机制已实现** — 支持N个成员策略投票, 可配置投票阈值/卖出模式/权重。5个多元化策略(KDJ/PSAR/BOLL%B+StochRSI/全指标/UltimateOsc)组合投票结果: threshold=2/5仅产生6笔交易+1.0%收益, 极低回撤(0.2%); threshold≥3/5全部零交易。多元化策略组合过于保守, 应使用同类指标(如3个KDJ变体)提高信号频率
28. **组合策略性能瓶颈** — 5成员组合回测每只股票需计算5组指标+5次条件评估/天, 单策略回测约10分钟(vs 普通策略<1分钟)。18成员组合超15分钟timeout。需优化: 减少成员数/缓存指标计算/并行评估

---

## 探索状态

| 优先级 | 方向 | 子主题 | 状态 | 实验数 | 盈利率 | 最佳收益 | 备注 |
|--------|------|--------|------|--------|--------|----------|------|
| P1 | 震荡市 | KDJ短周期+震荡专属参数 | 已探索 | 1 | 16.7% | +2.5% | KDJ(5,2,2)+窄超买超卖区间, 仅1/6盈利, 震荡市KDJ利润极薄 |
| P1 | 震荡市 | VWAP均值回归→RSI+CMF | 已探索 | 2 | 0% | -77.2% | 原版8/8 invalid; 重试RSI+CMF替代, 6/8 invalid, 2有效均巨亏 |
| P1 | 震荡市 | BOLL收窄+KDJ | 已探索 | 2 | 0% | -3.7% | 原版8/8 invalid; 简化版4/8 invalid, 4有效均亏损, 最小亏损-3.7% |
| P1 | 震荡市 | CMF资金流反转 | 已弃 | 2 | 0% | — | CMF在A股几乎永远为负, 独立使用不可行; 3次重试全部invalid或零交易 |
| P2 | 指标组合 | VWAP+KDJ | 已弃 | — | — | — | VWAP需field-to-field比较, 规则引擎不支持 |
| P2 | 指标组合 | BOLL_lower+MACD | 僵尸 | 1 | — | — | ID96信号爆炸, 回测卡死数天, 视为失败 |
| P2 | 指标组合 | CMF+KDJ金叉 | 僵尸 | 1 | — | — | ID95信号爆炸+CMF不可用, 回测卡死, 视为失败 |
| P2 | 指标组合 | KDJ+RSI双确认 | 已探索 | 1 | 0% | -1.0% | ID98: 5有效3invalid, 全部亏损, 震荡市杀伤大 |
| P2 | 指标组合 | KDJ超卖+EMA趋势 | 已探索 | 1 | 0% | -0.1% | ID99: 5有效3invalid, 全部亏损, 激进版巨亏-88% |
| P2 | 指标组合 | MACD+RSI超卖底部 | 已探索 | 1 | 6.7% | +9.0% | ID100: 5有效3invalid, 1盈利(+9%, dd 48.9%, score 0.48) |
| P2 | 指标组合 | EMA+ATR止损 | 已弃 | 1 | 0% | -50.3% | ID101: 8有效0invalid, 全部巨亏(-50%~-98%), 震荡市尤其灾难 |
| P2 | 指标组合 | KDJ+MACD短周期精调 | 已探索 | 1 | 12.5% | +17.5% | ID102: 8有效, 1盈利(score 0.57), 不如默认参数 |
| P2 | 单指标深挖 | RSI极端超卖反弹 | 已探索 | 2 | 66.7% | +6.1% | ID103(75%invalid)+ID104(简化版4/6盈利), 信号极少(4-17笔), 收益微薄 |
| P2 | 新方向 | KDJ金叉+放量确认 | 已弃 | 1 | 0% | -18.9% | ID105: 8有效, 全部亏损。放量在A股超卖区不是有效确认信号 |
| P2 | 新方向 | MACD柱线翻正趋势 | 已弃 | 1 | 0% | -37.1% | ID106: 8有效, 全部巨亏(-37%~-99.8%), 信号过频繁, 震荡市灾难 |
| P2 | 参数优化 | KDJ金叉止盈止损优化 | 已弃 | 1 | 0% | -35.3% | ID107: 8有效, 全部亏损。DeepSeek无法精确复现原始策略条件 |
| P2 | 指标组合 | BOLL_lower+KDJ field比较 | 已弃 | 3 | 0% | — | ID108-110: field比较功能正常, 但close<BOLL_lower+KDJ超卖极少触发, 全部零交易invalid |
| P2 | 趋势过滤 | KDJ+ADX趋势强度过滤 | 已弃 | 1 | 0% | -17.0% | ID111: 6有效2invalid, 0盈利。ADX>25无法过滤震荡, ranging亏-357~-743 |
| P2 | 趋势过滤 | KDJ金叉+MA20方向确认 | 已探索 | 1 | 14.3% | +2.7% | ID112: 7有效1invalid, 1盈利(保守版A +2.7%, score 0.58, dd 6%). 收益太低 |
| P2 | 指标组合 | KDJ+RSI双超卖底部 | 已探索 | 1 | 12.5% | +0.2% | ID113: 8有效, 1盈利(中性版C +0.2%, 18笔). 双超卖信号太少, 无统计意义 |
| P2 | 新指标 | MASS梅斯线反转 | 已探索 | 1 | 0% | -3.5% | ID136: MASS>27反转凸起, 8策略0盈利 |
| P2 | 新指标 | PVO+ADI量价组合 | 已探索 | 1 | 0% | -8.9% | ID137: PVO/ADI全亏 |
| P2 | 新指标 | Aroon+Vortex双趋势 | 已弃 | 2 | 0% | — | ID138: 信号爆炸; ID144: 0盈利; Vortex DeepSeek生成失败 |
| P2 | 新指标 | TSI+PSAR动量 | 已探索 | 1 | 0% | -12.5% | ID139: TSI>0.02几乎always true, 信号爆炸 |
| P2 | 新指标 | Donchian通道突破 | 已探索 | 2 | 0% | -7.8% | ID140+143: 海龟交易法全亏, 趋势追踪在A股无效 |
| P2 | 新指标 | **BOLL%B+StochRSI** | 已探索 | 1 | **12.5%** | **+37.9%** | ID141: S1059达Standard A! 牛+275熊+181 |
| P2 | 新指标 | PPO+TSI动量组合 | 已弃 | 2 | 0% | -84.0% | ID124全invalid; ID142 4done全亏, 激进版-84% |
| P2 | 新指标 | Ichimoku云层突破 | 已探索 | 1 | 0% | — | ID145: 信号爆炸风险高, close>ICHIMOKU_a太宽松 |
| P2 | 新指标 | **Stochastic(STOCH)** | 已探索 | 2 | **33%** | **+28.4%** | ID128: 2/4盈利(50%!); ID146: 1/6盈利(16%). STOCH类似KDJ |
| P2 | 新指标 | STC沙夫趋势周期 | 已探索 | 1 | 14% | +22.7% | ID147: 1/7盈利, 中性版B +22.7%, dd 39.4%高 |
| P2 | 新指标 | **UltimateOscillator** | 已探索 | 2 | **25%** | **+28.0%** | ID129: 3/6盈利(50%!), 中性版C score 0.72 **Standard A**; ID148: 0盈利 |
| P2 | 新指标 | **Keltner+ULCER低波动** | 已探索 | 1 | **37.5%** | **+19.5%** | ID149: 3/8盈利! ULCER<5+KDJ_K<25效果好 |
| P2 | 新指标 | KST确知指标 | 已弃 | 2 | 0% | — | ID131+150全部invalid, KST在A股完全无效 |
| P2 | 新指标 | **PSAR+KDJ组合** | 已探索 | 1 | **37.5%** | **+14.3%** | ID151: 3/8盈利, S1141达Standard A, 震荡市+95 |
| P2 | 新指标 | AO+KDJ组合 | 已弃 | 1 | 0% | -6.5% | ID152: 6done全亏2invalid |
| P2 | 新指标 | FI+EMV量价 | 已弃 | 2 | 0% | -30.2% | ID132: 1done全亏7invalid; ID153: 5done全亏3invalid |
| P2 | 新指标 | WMA+AO组合 | 已弃 | 1 | 0% | — | ID130: 全部invalid |
| P2 | 新指标 | Vortex+KDJ | 已弃 | 2 | — | — | ID154+155: DeepSeek生成失败, Vortex指标不可用 |
| P3 | 策略组合 | 信号投票/加权 | **已实现+验证** | 3 | 100%(2/2有效) | +1.0% | **已实现**: 投票机制+回测+信号+AI Lab实验。5成员多元化组合仅6笔交易, 极度保守(dd 0.2%) |
| P4 | 规则引擎 | 条件可达性预检 | **已完成** | — | — | — | check_reachability()检测矛盾条件+超出范围值, 已集成到AI Lab回测前 |
| P4 | 规则引擎 | N日回溯条件 | **已完成** | — | — | — | lookback_min/max/value + consecutive, 支持N日新高/新低/连涨连跌 |
| P4 | 规则引擎 | 百分比偏差条件 | **已完成** | — | — | — | pct_diff + pct_change, 支持VWAP偏离/N日涨跌幅 |
| P4 | 规则引擎 | DeepSeek新类型采纳 | 待优化 | 2 | 0% | — | E2E验证: DeepSeek不主动使用新类型, 需更强few-shot或模板化 |

---

## Auto-Promote 记录

| 日期 | 策略名 | 标签 | 评分 | 收益 | 回撤 | Promote标准 |
|------|--------|------|------|------|------|------------|
| 2026-02-14 | 全指标综合_中性版C | [AI] | 0.78 | +58.5% | 14.6% | Standard A |
| 2026-02-14 | 全指标综合_保守版B | [AI] | 0.75 | +29.1% | 4.0% | Standard A |
| 2026-02-14 | KDJ金叉_中性版A | [AI] | 0.70 | +37.1% | 9.8% | Standard A + 震荡冠军 |
| 2026-02-14 | KDJ金叉_激进版B | [AI] | 0.70 | +31.5% | 9.1% | Standard A |
| 2026-02-14 | KDJ短周期快速交易_保守版A | [AI] | 0.69 | +21.5% | 6.6% | Standard A |
| 2026-02-14 | KDJ超短线_中性版A | [AI] | 0.69 | +25.9% | 21.0% | Standard A |
| 2026-02-14 | KDJ金叉+MACD双金叉_中性版A | [AI] | 0.68 | +34.1% | 17.9% | Standard A + 熊市冠军 |
| 2026-02-14 | 三指标共振_中性版C | [AI] | 0.68 | +28.2% | 24.9% | Standard A |
| 2026-02-14 | KDJ极致保守策略_保守版B | [AI] | 0.66 | +21.8% | 15.2% | Standard A |
| 2026-02-14 | KDJ低位金叉+均线多头_中性版C | [AI] | 0.65 | +12.7% | 14.5% | Standard A |
| 2026-02-14 | BOLL%B+StochRSI_中性版C | [AI] | 0.66 | +37.9% | 23.3% | Standard A (第十轮新指标) |
| 2026-02-14 | PSAR+ADX+CCI+BOLL_保守版B | [AI] | 0.66 | +14.3% | 6.1% | Standard A (第十轮新指标) |
| 2026-02-15 | 全指标综合_中性版C_全紧 | [AI] | **0.81** | **+75.6%** | 12.2% | Standard A (克隆调参最佳) |
| 2026-02-15 | 全指标综合_中性版C_快止盈15pct | [AI] | **0.80** | +69.1% | 12.8% | Standard A (克隆调参) |
| 2026-02-15 | 全指标综合_中性版C_紧止损5pct | [AI] | 0.75 | +46.5% | 14.7% | Standard A (克隆调参) |
| 2026-02-15 | UltimateOsc_中性版C | [AI] | **0.72** | +28.0% | 11.2% | Standard A (新指标发现) |
| 2026-02-15 | VWAP均值回归_保守版A | [AI] | 0.65 | +14.7% | 7.9% | Standard A |
| 2026-02-15 | MACD+RSI双确认_保守版B | [AI] | 0.67 | +29.8% | 22.1% | Standard A |
| 2026-02-14 | KDJ+ATR动态止损_中性版C | [AI-牛市] | 0.58 | +1.2% | 9.0% | Standard B 牛市冠军 |

---

## 最佳策略 Top 15 (跨所有实验)

| # | 策略名 | 评分 | 收益 | 回撤 | 胜率 | 交易数 | 来源 |
|---|--------|------|------|------|------|--------|------|
| 1 | 全指标综合_中性版C_全紧 | **0.81** | **+75.6%** | 12.2% | — | 613 | **克隆调参** |
| 2 | 全指标综合_中性版C_快止盈15pct | **0.80** | +69.1% | 12.8% | — | 574 | **克隆调参** |
| 3 | 全指标综合_中性版C | 0.78 | +58.5% | 14.6% | 29.9% | 545 | P0修复 |
| 4 | 全指标综合_保守版B | 0.75 | +29.1% | 4.0% | 39.3% | 272 | P0修复 |
| 5 | 全指标综合_中性版C_紧止损5pct | 0.75 | +46.5% | 14.7% | — | 547 | **克隆调参** |
| 6 | **UltimateOsc_中性版C** | **0.72** | +28.0% | 11.2% | — | 262 | **批量重试新发现** |
| 7 | KDJ金叉_中性版A | 0.70 | +37.1% | 9.8% | 47.5% | 810 | 第三轮 |
| 8 | KDJ金叉_激进版B | 0.70 | +31.5% | 9.1% | 45.2% | 641 | 第三轮 |
| 9 | KDJ短周期快速交易_保守版A | 0.69 | +21.5% | 6.6% | 54.1% | 61 | 第四轮 |
| 10 | KDJ超短线_中性版A | 0.69 | +25.9% | 21.0% | 25.5% | 624 | 第四轮 |
| 11 | 三指标共振_中性版C | 0.68 | +28.2% | 24.9% | 24.0% | 847 | P0修复 |
| 12 | KDJ金叉+MACD双金叉_中性版A | 0.68 | +34.1% | 17.9% | 37.8% | 421 | 第四轮 |
| 13 | MACD+RSI双确认_保守版B | 0.67 | +29.8% | 22.1% | — | 525 | **批量重试promote** |
| 14 | BOLL%B+StochRSI_中性版C | 0.66 | +37.9% | 23.3% | 26.2% | 233 | 第十轮新指标 |
| 15 | PSAR+ADX+CCI+BOLL_保守版B | 0.66 | +14.3% | 6.1% | 39.5% | 256 | 第十轮新指标 |

---

## 全阶段盈利策略 (牛+熊+震荡都赚钱)

| 策略名 | 总收益 | 评分 | 实验来源 |
|--------|--------|------|---------|
| KDJ金叉_中性版A | **+37.1%** | 0.70 | 第三轮 |
| KDJ金叉_激进版B | +31.5% | 0.70 | 第三轮 |
| KDJ超短线_中性版A | +25.9% | 0.69 | 第四轮 |
| KDJ短周期快速交易_保守版A | +21.5% | 0.69 | 第四轮 |
| KDJ低位金叉+均线多头排列_中性版C | +12.7% | 0.65 | 第四轮 |

> 共同特征: 全部为短线/超短线, 持仓时间短、换手快。

---

## 各市场阶段最优 (Top 3)

### 牛市 (87% KDJ策略盈利)

| 策略名 | 牛市盈亏 | 牛市胜率 | 总收益 |
|--------|---------|---------|--------|
| KDJ+ATR动态止损_中性版C | +686元 | 53.3% | +1.2% |
| KDJ+EMA短线趋势_中性版B | +568元 | 59.8% | +14.8% |
| KDJ中周期趋势_中性版C | +561元 | 45.9% | +60.7% |

### 熊市 (仅26%策略盈利)

| 策略名 | 熊市盈亏 | 熊市胜率 | 总收益 |
|--------|---------|---------|--------|
| KDJ金叉+MACD双金叉_中性版A | +368元 | 45.0% | +34.1% |
| KDJ金叉_激进版A | +246元 | 44.6% | +13.9% |
| KDJ+ATR动态止损_中性版B | +228元 | 52.9% | +22.2% |

### 震荡市 (仅4%策略盈利 — 最大瓶颈)

| 策略名 | 震荡盈亏 | 震荡胜率 | 总收益 |
|--------|---------|---------|--------|
| KDJ金叉_中性版A | +195元 | 47.1% | +37.1% |
| KDJ短周期快速交易_激进版A | +127元 | 47.4% | +14.7% |
| KDJ短周期快速交易_保守版A | +70元 | 53.6% | +21.5% |

---

## 扩展指标表现

### 原有扩展指标 (P0修复后)

| 指标 | 策略数 | 盈利率 | 最佳收益 |
|------|--------|--------|----------|
| VWAP | 20 | **30.0%** | +29.1% |
| CMF | 19 | **21.1%** | +29.1% |
| ROC | 24 | 16.7% | +28.2% |
| BOLL_lower | 61 | 14.8% | +59.0% |
| WR | 29 | 13.8% | +19.2% |
| CCI | 68 | 13.2% | +58.5% |
| MFI | 56 | 12.5% | +59.0% |
| BOLL_middle | 49 | 12.2% | +58.5% |
| BOLL_upper | 45 | 8.9% | +14.6% |
| TRIX | 32 | 6.2% | +10.8% |
| DPO | 28 | **0.0%** | -0.1% |

### 第十轮新指标 (33个TA-lib新增指标, 全部完成)

| 指标 | 策略数(done) | 盈利率 | 最佳收益 | 备注 |
|------|--------|--------|----------|------|
| **ULTOSC** | 14 | **21.4%** | **+28.0%** | **ID129: 3/6盈利(50%!), 中性版C score 0.72 Standard A!** ID148超卖版0盈利 |
| **ULCER** | 8 | **37.5%** | +19.5% | ULCER<5过滤下行风险, 与KDJ/ATR组合效果好 |
| **PSAR** | 8 | **37.5%** | +14.3% | PSAR+多指标组合Standard A, 震荡市罕见盈利 |
| **STOCH** | 10 | **30.0%** | +28.4% | ID128: 2/4盈利(50%); ID146: 1/6盈利. 类似KDJ |
| **StochRSI** | 8 | **12.5%** | +37.9% | BOLL%B+StochRSI Standard A, 最佳新发现 |
| STC | 7 | 14.3% | +22.7% | ID147: 1/7盈利, dd 39.4%偏高 |
| FI(力量指标) | 1 | 0% | -34.8% | ID132: 仅1done全亏, 大部分invalid |
| MASS | 8 | 0% | -3.5% | MASS反转凸起在A股无效 |
| PVO | 8 | 0% | -8.9% | 量价震荡无效 |
| ADI | 8 | 0% | -8.9% | 累积派发无效 |
| AROON | 8+ | 0% | — | 信号爆炸或0盈利 |
| TSI | 8 | 0% | -12.5% | TSI阈值难设, 几乎always true |
| DONCHIAN | 16 | 0% | -7.8% | 海龟交易法在A股失效 |
| AO | 6 | 0% | -6.5% | 动量震荡无效 |
| PPO | 4 | 0% | -84.0% | PPO+TSI组合灾难性亏损 |
| KST | 0 | — | — | 全部invalid, 指标不可用 |
| WMA | 0 | — | — | 全部invalid |
| ICHIMOKU | 8 | 0% | — | 信号爆炸, 条件太宽松 |
| VORTEX | — | — | — | DeepSeek无法生成, 2次尝试均失败 |
| EMV | 6 | 0% | -30.2% | FI+EMV组合全亏 |

---

## 历史实验摘要

### 第一轮 (4模板, 32策略)
盈利 2/23 (8.7%), 最佳 +11.1%

### 第二轮 (15实验, 120策略)
盈利 9/46 (19.6%), 最佳 +32.2%, 数据缺陷导致回撤虚高(86.8%)

### 第三轮 (15实验, 120策略, 数据修复后)
盈利 6/51 (11.8%), 最佳 +37.1% (KDJ金叉_中性版A), 回撤回归正常(58.7%), 数据修复验证成功

### 第四轮: KDJ深挖 (67实验, 536策略)
盈利 26/258 (10.1%), 最佳 +60.7%, >30%收益 2个。KDJ+EMA最佳组合(43%盈利率), 短周期(6,3,3)优于默认, 5个策略全阶段盈利。盈利率最高主题: KDJ+EMA(43%), KDJ短周期(40%), KDJ紧止损(40%)。零盈利: 33个主题(KDJ长周期、纯ADX/OBV/CCI/WR组合、J值极端反转等)。

### P0修复: 扩展指标收集Bug回测 (292策略)
修复成功 273/292 (93.5%), 新增盈利 31 (11.4%), 最佳: 全指标综合_中性版C (+58.5%, score 0.78), MACD金叉_保守版B (+59.0%, score 0.66)

### 第五轮: P1震荡市+P2指标组合 (9实验含4次自愈重试, 72策略)
**P1震荡市**(7实验): 盈利 1/12有效 (8.3%), 最佳 +2.5%。VWAP/BOLL带宽/CMF三个方向全部失败, 累计5次重试。根因: 规则引擎不支持field-to-field, DeepSeek生成不支持条件, CMF在A股持续为负不可用。仅KDJ超短(5,2,2)微利+2.5%。结论: P1方向全部关闭。
**P2指标组合-早期**(2实验): ID95(CMF+KDJ)和ID96(BOLL+MACD)条件过宽导致信号爆炸, 回测超慢(单策略>40min), 仍在进行中。
**关键发现**: CMF_20在A股绝大多数股票持续为负, 独立使用完全不可行。

### 第六轮: P2指标组合深入 (3实验, 24策略)
盈利 1/15有效 (6.7%), 最佳 +9.0% (MACD金叉+RSI超卖_中性版A)。9/24 invalid (37.5%), 0零交易。
- **ID98 KDJ+RSI双确认**: 5有效, 0盈利。最佳-1.0%(中性版A仅3笔交易)。震荡市亏损严重。
- **ID99 KDJ超卖+EMA趋势**: 5有效, 0盈利。最佳-0.1%(中性版A)。激进版灾难(-74%~-88%)。
- **ID100 MACD+RSI超卖**: 5有效, 1盈利。中性版A +9.0%(score 0.48, dd 48.9%, 牛市+366熊市+10)。

### 第七轮: P2收尾+新方向 (4实验含1次自愈重试, 32策略)
盈利 5/24有效 (20.8%), 最佳 +17.5%。2/32 invalid (6.3%), 0零交易。
- **ID101 EMA+ATR动态止损**: 8有效0invalid, **0盈利**。全部巨亏(-50%~-98%), 震荡市单策略亏损超1000元。彻底否定纯EMA趋势追踪。
- **ID102 KDJ+MACD短周期精调**: 8有效0invalid, **1盈利**。中性版A +17.5%(score 0.57, dd 27.8%), 牛市+253熊市+107。但远不如默认参数组合(+34.1%, score 0.68), 短周期精调无优势。
- **ID103 RSI极端超卖反弹**: 2有效**6invalid**, 1盈利(+6.1%)。DeepSeek生成大量不支持条件, 触发自愈重试。
- **ID104 RSI极端超卖反弹(简化版)**: 6有效2invalid, **4盈利**(66.7%!)。最佳+5.4%(score 0.62, dd 1.8%), 但仅17笔交易。RSI<25极端超卖盈利率极高但信号过少, 统计意义不足。
**结论**: P2探索基本结束。EMA+ATR彻底否定; KDJ+MACD默认参数已最优; RSI超卖有理论价值但实际信号太少。所有非KDJ主导方向已探索完毕。

### 第八轮: 新方向+参数优化 (3实验, 24策略)
盈利 0/24有效 (0.0%), 全部亏损。0 invalid, 0 零交易。
- **ID105 KDJ金叉+放量确认**: 8有效, **0盈利**。放量条件对KDJ无增益, 最佳-18.9%。A股超卖放量多为出货。
- **ID106 MACD柱线翻正趋势**: 8有效, **0盈利**。MACD_hist>0作为主信号灾难性, 亏损-37%~-99.8%。信号过频繁, 震荡市单策略亏损超3000元。
- **ID107 KDJ金叉止盈止损优化**: 8有效, **0盈利**。尝试复现已有最佳策略(+37.1%)并优化止盈止损, 但DeepSeek生成的规则与原始存在微妙差异, 导致全部亏损(-35%~-81%)。
**结论**: 放量、MACD独立、参数"优化"三个新方向全部失败。自动探索已穷尽所有可行的双指标组合和辅助条件方向。剩余可能的提升路径：(1)手动编辑现有最佳策略的止盈止损参数(不通过DeepSeek); (2)后端支持组合策略(P3); (3)规则引擎升级支持更复杂条件。

### 第十轮: 大规模新指标探索 (20实验, 144策略, 全部完成)
**目标**: 扩展indicator_registry从10→33个指标组, 探索STOCH/STC/ULTOSC/KELTNER/KST/PSAR/AO/FI/EMV/VORTEX/AROON/ICHIMOKU/DONCHIAN等新指标。
**最终**: 89/144 done, 55/144 invalid. **盈利 14/89 (15.7%)**, 3个达Standard A:
- **S979 UltimateOsc_中性版C**: +28.0%, score **0.72**, dd 11.2%, 262 trades. **Standard A已promote** (批量重试新发现!)
- **S1059 BOLL%B+StochRSI_中性版C**: +37.9%, score 0.66, dd 23.3%, 233 trades. **Standard A已promote**
- **S1141 PSAR+ADX+CCI+BOLL_保守版B**: +14.3%, score 0.66, dd 6.1%, 256 trades. **Standard A已promote**
- Stochastic_保守版C (ID128): +28.4%, score 0.60, dd 23.4%
- STC超卖反弹_中性版B (ID147): +22.7%, score 0.53, dd 39.4%
- S1131 肯特纳通道低波动_中性版C: +19.5%, score 0.60, dd 19.0%
- S1133 肯特纳通道低波动_保守版B: +13.3%, score 0.59, dd 17.6%
- S1138 PSAR+RSI+BOLL_中性版B: +6.3%, score 0.61, dd 8.9%. 震荡市+95(罕见!)
- 其余6个: +0.6%~+8.0%, 收益较低
**无效指标**: PPO/KST/WMA/FI+EMV/MASS/PVO/ADI/DONCHIAN/AO/AROON/ICHIMOKU/VORTEX

### 第十一轮: 批量重试 (323策略, 2026-02-15)
**背景**: 清理僵尸实验、修复挂死问题后, 将所有failed/invalid/pending策略(323个, 跨67个实验)统一重置并批量重试。实施三层防护系统防止挂死。
**处理时间**: ~6.5小时 (10:05-16:45), 零挂死。
**结果**: +77 done (745→822), +241 invalid (23→264)
- 75.8%被标记invalid — 主要原因: 信号爆炸(L1增强检测), 零交易, field-to-field比较不支持
- **6个新promote策略**: 全紧(0.81), 快止盈(0.80), 紧止损(0.75), UltimateOsc(0.72), VWAP(0.65), MACD+RSI(0.67)
- **关键发现**: UltimateOscillator是唯一通过重试达到Standard A的新指标; 克隆调参系列(全紧/快止盈/紧止损)成为Top 3
**三层防护系统验证**: L1增强信号爆炸检测快速捕获问题策略; L2单策略5分钟超时无一触发(说明策略级别正常); L3看门狗无一触发(无实验超60分钟)

### P3: 组合策略投票 (3实验, 41策略)
**目标**: 实现P3方向 — 多策略信号投票/加权组合。将多个promoted策略的买入/卖出条件通过投票机制组合。
**实现**: 新增combo策略类型, 支持vote_threshold/weight_mode/sell_mode配置。修改portfolio_engine/signal_engine/backtest_engine/ai_lab_engine。
**实验结果**:
- **ID154/155 18成员组合** (全部promoted策略): 所有策略超时(5分钟内仅完成51天/730天), 已标记invalid并跳过。18成员性能不可行。
- **ID156 5成员精选组合** (KDJ金叉/全指标综合/PSAR/BOLL%B+StochRSI/UltimateOsc):
  - **投票2/5**: ✅ score=0.44, ret=+1.0%, dd=0.2%, 6 trades — 极保守但盈利
  - **投票2/5_多数卖出**: ✅ score=0.54, ret=+0.8%, dd=0.6%, 6 trades — majority sell模式得分更高
  - **投票3/5~5/5**: 全部零交易 — 多元化策略难以同时达成共识
**关键发现**: 多元化组合极度保守(6笔/2年), 回撤极低(0.2%). 下一步应使用同类指标组合(如3个KDJ变体)提高信号频率。
**bug修复**: (1) combo timeout: 5min→15min; (2) regime_stats清除导致重试失败: 添加sibling fallback恢复机制; (3) combo endpoint忽略body参数: 修复为接受member_strategy_ids

### BOLL field比较实验 (3实验, 24策略)
- **ID108/109 BOLL通道突破_field比较**: 16/16 invalid(零交易)。close<BOLL_lower(field比较)+KDJ_K<25太严苛, 3年回测期内从未触发。
- **ID110 BOLL通道_debug**: 僵尸实验(stuck in backtesting), 1/8 invalid, 其余pending/backtesting。
**结论**: field-to-field比较功能正常(P7非bug), 但BOLL下轨+超卖双重条件极度罕见。BOLL需用更宽松阈值(如close<BOLL_middle)或不组合超卖。

### 第九轮: 趋势过滤+双超卖 (3实验, 24策略)
盈利 2/21有效 (9.5%), 最佳 +2.7%。3 invalid, 0 零交易(除BOLL)。
- **ID111 KDJ+ADX趋势过滤**: 6有效2invalid, **0盈利**。ADX>25无法有效过滤震荡市, ranging亏损-357~-743。牛市有正收益(+82~+367)但被震荡市抵消。
- **ID112 KDJ金叉+MA20方向确认**: 7有效1invalid, **1盈利**。保守版A +2.7%(score 0.58, dd 6%, 62 trades), ranging仅亏-10(最小), 但收益太低。
- **ID113 KDJ+RSI双超卖底部**: 8有效0invalid, **1盈利**。中性版C +0.2%(score 0.54, 18 trades), 实质上是持平。双超卖条件太严格, 信号极少。
**结论**: 趋势过滤方向(ADX/MA20)无法解决震荡市问题。双超卖(KDJ+RSI)信号太少。**双指标组合自动探索彻底穷尽。**

### 克隆调参实验 (6个克隆, ID114-119)
使用新建的clone-backtest API, 克隆top策略并修改exit_config进行参数优化。
- **KDJ金叉_中性版A_紧止损5pct** (ID114): ret=-24.3%, score=0.41, 2146 trades. 止损-5% vs原-9%, 显著更差。
- **KDJ金叉_中性版A_紧止损快止盈** (ID115): ret=-18.4%, score=0.43, 2151 trades. 止损-5%+止盈15%.
- **KDJ金叉_中性版A_快轮换10d** (ID116): ret=-5.0%, score=0.49, 2110 trades. 持仓10天 vs原20天, 最佳变体。
- **全指标综合_中性版C × 3变体** (ID117-119): **批量重试后全部成功!**
  - 全紧: score **0.81**, ret **+75.6%**, dd 12.2%, 613 trades — **全局第一!**
  - 快止盈15pct: score **0.80**, ret +69.1%, dd 12.8%, 574 trades
  - 紧止损5pct: score 0.75, ret +46.5%, dd 14.7%, 547 trades
**关键发现**: (1) 收紧止损严重损害KDJ策略表现(-9%→-5%止损导致收益从+37%→-24%); (2) 缩短持仓期有微弱改善(-5% vs -24%); (3) 全指标综合克隆调参在批量重试后全部成功且表现优异, 之前"0交易invalid"是因回测引擎bug(已修复)。

---

## 已知问题

| 编号 | 问题 | 状态 |
|------|------|------|
| P0 | 扩展指标收集bug | 已修复 2026-02-13 |
| P1 | 评分体系区分度 | 已修复 2026-02-12 |
| P2 | 策略生成多样性 | 已修复 2026-02-12 |
| P3 | 止损穿越 | 已修复 2026-02-12 |
| P4 | 零交易~50% | 持续优化中 |
| P5 | DeepSeek prompt bug | 已修复 2026-02-12 |
| P6 | 数据完整性 | 已修复+验证 2026-02-12 |
| P17 | 组合策略 | **已实现** 2026-02-15 — combo策略类型, 投票机制, AI Lab实验验证成功 |
| P18 | 组合策略回测慢 | 持续 — 5成员~10min, 18成员>15min timeout. 需缓存指标/并行评估 |
| P19 | 条件可达性预检 | **已实现** 2026-02-15 — check_reachability()检测矛盾+超范围, 集成AI Lab |
| P20 | 规则引擎P4升级 | **已完成** 2026-02-15 — 6种新compare_type + 条件预检 + validate增强 + DeepSeek prompt |
| P21 | DeepSeek不使用新条件类型 | 新发现 2026-02-15 — 即使prompt明确要求, DeepSeek仍只用value/field类型, 需few-shot模板 |
| P7 | field-to-field比较: 功能正常, BOLL下轨+超卖触发率极低 | 已验证 2026-02-14 (非bug) |
| P8 | ID110僵尸实验stuck in backtesting | 已修复 2026-02-14 (强制标记failed) |
| P9 | ID95/96僵尸实验(信号爆炸) | 已自然结束(status=failed) |
| P10 | 全指标综合策略无法复现(ATR<0.05不可达) | 新发现 2026-02-14 — 原P0重跑的545笔交易可能使用了不同代码路径 |
| P11 | 收紧止损反而损害KDJ策略 | 已验证 2026-02-14 — -9%→-5%导致+37%→-24%, 信号需要呼吸空间 |
| P12 | Vortex指标DeepSeek无法生成 | 已确认 2026-02-14 — 2次尝试均在generating阶段超时, Vortex指标对DeepSeek不可用 |
| P13 | 信号爆炸策略阻塞队列 | **已修复** 2026-02-14+增强 2026-02-15 — L1增强: 周期性重检(每50天, 阈值300), 不仅前10天检测 |
| P14 | 回测队列处理慢(~2并发) | 持续 — 323策略需6.5小时, 可考虑增加并发 |
| P15 | 回测挂死(策略/实验级) | **已修复** 2026-02-15 — 三层防护: L1信号爆炸增强, L2单策略5分钟超时(Timer+cancel_event), L3实验60分钟看门狗 |
| P16 | 批量重试机制 | **已实现** 2026-02-15 — POST /api/lab/experiments/{id}/retry + POST /api/lab/experiments/retry-pending |
